{% extends "base.html" %}
{% block title %}Overview{% endblock %}
{% block topbar_title %}Overview{% endblock %}
{% block content %}
<!-- PAGE: Overview (route: /) -->
<section id="overview-page" data-page="overview">

  <!-- SECTION: Stats -->
  <section id="overview-stats" class="grid3 page-section" aria-label="Overview statistics">
    <div class="stat-tile">
      <div class="stat-label">Connected Peers</div>
      <div class="stat-value green" id="stat-peers">0</div>
      <div class="stat-sub" id="stat-peers-sub">no peers</div>
    </div>
    <div class="stat-tile">
      <div class="stat-label">Submitted Apps</div>
      <div class="stat-value accent" id="stat-submitted">0</div>
      <div class="stat-sub">running on peers</div>
    </div>
    <div class="stat-tile">
      <div class="stat-label">Executing Apps</div>
      <div class="stat-value accent" id="stat-executing">0</div>
      <div class="stat-sub">from peers, on this cluster</div>
    </div>
  </section>

  <!-- SECTION: Connected Peers + Recent Apps -->
  <section id="overview-tables" class="grid2 page-section" aria-label="Peers and recent apps">
    <div class="card">
      <div class="card-header">
        <h2>Connected Peers</h2>
        <span class="badge badge-mtls" id="peers-count-badge">0</span>
      </div>
      <div class="card-body no-pad">
        <div class="table-wrap">
          <table>
            <thead><tr><th>Name</th><th>URL</th><th>Channel</th><th>Since</th></tr></thead>
            <tbody id="overview-peers-body"></tbody>
          </table>
        </div>
        <div class="empty-state" id="overview-peers-empty">
          <div class="empty-icon">&#8644;</div>No peers connected
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-header">
        <h2>Recent Apps</h2>
        <span class="badge badge-pending" id="recent-apps-count">0</span>
      </div>
      <div class="card-body no-pad">
        <div class="table-wrap">
          <table>
            <thead><tr><th>Name</th><th>Type</th><th>Status</th><th>Updated</th><th></th></tr></thead>
            <tbody id="recent-apps-body"></tbody>
          </table>
        </div>
        <div class="empty-state" id="recent-apps-empty">
          <div class="empty-icon">&#11041;</div>No apps yet
        </div>
      </div>
    </div>
  </section>

  <!-- SECTION: Deploy RemoteApp -->
  <section id="overview-deploy" class="page-section" aria-label="Deploy RemoteApp">
    <div class="card">
      <div class="card-header"><h2>Deploy RemoteApp</h2></div>
      <div class="card-body">
        <form id="deploy-form">
          <div class="deploy-form-layout" style="display:flex;flex-direction:column;gap:1rem;">
            <div class="form-group">
              <label class="form-label" for="app-name">App name</label>
              <input type="text" id="app-name" placeholder="e.g. my-nginx" required>
            </div>
            <div class="form-group">
              <label class="form-label" for="app-spec-yaml">Spec (YAML)</label>
              <div class="monaco-editor-wrap" id="deploy-editor-wrap">
                <div id="app-spec-editor" class="monaco-editor-host" aria-label="YAML spec editor"></div>
                <textarea
                  id="app-spec-yaml-fallback"
                  class="monaco-fallback-textarea"
                  spellcheck="false"
                  autocomplete="off"
                  autocorrect="off"
                  autocapitalize="off"
                  aria-label="YAML spec fallback"
                ></textarea>
              </div>
              <textarea id="app-spec-yaml" style="display:none;" aria-hidden="true"></textarea>
            </div>
            <div class="deploy-form-action" style="display:flex;justify-content:flex-end;">
              <button type="submit">Deploy to Peer</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </section>

</section>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ url_for('static', filename='js/setup-vscode-editor.js') }}"></script>
<script src="https://unpkg.com/monaco-editor@0.52.2/min/vs/loader.js"></script>
<script>
  (function () {
    if (!window.PorpulsionPages || !window.PorpulsionPages.initDeploySpecEditor) return;
    window.PorpulsionPages.initDeploySpecEditor();
  })();
</script>
{% endblock %}
