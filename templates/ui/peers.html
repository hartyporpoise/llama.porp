{% extends "base.html" %}
{% block title %}Peers{% endblock %}
{% block topbar_title %}Peers{% endblock %}
{% block content %}
<!-- PAGE: Peers (route: /peers) -->
<section id="peers-page" data-page="peers">

  <!-- SECTION: Inbound banner -->
  <section id="peers-inbound-banner" class="page-section" aria-label="Incoming connection requests">
    <div class="inbound-banner" id="inbound-banner">
      <div class="inbound-banner-title">
        <span class="pulse"></span> Incoming Connection Requests
      </div>
      <div class="inbound-list" id="inbound-list"></div>
    </div>
  </section>

  <!-- SECTION: Connect new peer + Credentials + All peers -->
  <section id="peers-connect-grid" class="grid2 page-section" aria-label="Connect peer and credentials">
    <div class="card">
      <div class="card-header"><h2>Connect a New Peer</h2></div>
      <div class="card-body">
        <form id="connect-peer-form"
              hx-post="/api/peers/connect"
              hx-ext="json-enc"
              hx-target="body"
              hx-swap="none"
              hx-trigger="submit">
          <div class="form-group">
            <label class="form-label" for="new-peer-url">Peer URL</label>
            <input type="url" id="new-peer-url" name="url" placeholder="https://porpulsion.example.com" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="new-peer-token">Their invite token</label>
            <input type="text" id="new-peer-token" name="invite_token" placeholder="paste their invite token here" autocomplete="off" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="new-peer-fp">Their CA fingerprint</label>
            <input type="text" id="new-peer-fp" name="ca_fingerprint" placeholder="paste their CA fingerprint here" autocomplete="off" style="font-family:monospace;font-size:0.75rem;" required>
            <span class="form-hint">Prevents MITM during bootstrap. Get this from their Settings.</span>
          </div>
          <div class="flex-end mt1">
            <button type="submit">Initiate Peering</button>
          </div>
        </form>
      </div>
    </div>
    <div class="card">
      <div class="card-header"><h2>Connect Credentials</h2></div>
      <div class="card-body">
        <p class="text-sm text-muted" style="margin-bottom:1rem;">
          Share your endpoint URL, invite token, and CA fingerprint with the peer who wants to connect to you.
        </p>
        <div class="section-label">Endpoint URL</div>
        <div class="code-box">
          <span class="code-val" id="token-url">loading…</span>
          <button type="button" class="btn-sm" onclick="window.Porpulsion.copyText('token-url', this)">Copy</button>
        </div>
        <div class="section-label" style="margin-top:1rem;">Invite token (single-use)</div>
        <div class="secret-box">
          <span class="secret-val masked" id="token-key" data-value="">••••••••••••••••••••••••••••••••</span>
          <button type="button" class="eye-btn" onclick="window.Porpulsion.toggleSecret('token-key', this)" title="Show/hide" aria-label="Toggle visibility"><svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.6"><path d="M1 10s3.5-6 9-6 9 6 9 6-3.5 6-9 6-9-6-9-6z"/><circle cx="10" cy="10" r="2.5"/></svg></button>
          <button type="button" class="btn-sm" onclick="window.Porpulsion.copySecret('token-key', this)">Copy</button>
        </div>
        <div class="section-label" style="margin-top:1rem;">CA fingerprint</div>
        <div class="secret-box">
          <span class="secret-val masked" id="token-fp-peers" data-value="" style="font-size:0.68rem;">••••••••••••••••••••••••••••••••••••••••••••••••</span>
          <button type="button" class="eye-btn" onclick="window.Porpulsion.toggleSecret('token-fp-peers', this)" title="Show/hide" aria-label="Toggle visibility"><svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.6"><path d="M1 10s3.5-6 9-6 9 6 9 6-3.5 6-9 6-9-6-9-6z"/><circle cx="10" cy="10" r="2.5"/></svg></button>
          <button type="button" class="btn-sm" onclick="window.Porpulsion.copySecret('token-fp-peers', this)">Copy</button>
        </div>
      </div>
    </div>
    <div class="card full">
      <div class="card-header">
        <h2>All Peers</h2>
        <span class="badge badge-pending" id="all-peers-count">0</span>
      </div>
      <div class="card-body no-pad">
        <div class="table-wrap">
          <table>
            <thead><tr><th>Name</th><th>URL</th><th>Peering</th><th>Channel</th><th>Connected</th><th></th></tr></thead>
            <tbody id="all-peers-body"></tbody>
          </table>
        </div>
        <div class="empty-state" id="all-peers-empty">
          <div class="empty-icon">&#8644;</div>No peers yet
        </div>
      </div>
    </div>
  </section>

</section>
{% endblock %}
