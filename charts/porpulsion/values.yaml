# ──────────────────────────────────────────────────────────────────────────────
# porpulsion — peer-to-peer Kubernetes connector
# Helm chart default values
# ──────────────────────────────────────────────────────────────────────────────

# -- Namespace where the agent and all RemoteApp workloads are deployed.
namespace: porpulsion

# ── Agent ──────────────────────────────────────────────────────────────────────
agent:
  # -- Container image for the porpulsion agent.
  image: ghcr.io/hartyporpoise/porpulsion:latest

  # -- Image pull policy. Use `Always` when pushing to a remote registry.
  pullPolicy: IfNotPresent

  # -- Number of agent replicas. Only 1 is supported; this field is reserved.
  replicas: 1

  # -- Human-readable name for this agent, shown in the dashboard and used
  #    during peer handshakes. Defaults to the hostname if unset.
  agentName: ""

  # -- Externally reachable URL for this agent (e.g. https://porpulsion.example.com).
  #    Peer agents use this address for the initial peering handshake and the
  #    persistent WebSocket channel (/ws). Should be your Ingress or
  #    LoadBalancer hostname. Auto-detected from the pod's default route if left
  #    empty, but explicit is recommended in production.
  selfUrl: ""

# ── Service ────────────────────────────────────────────────────────────────────
# The Service exposes two ports:
#   8000 (ui)      — dashboard and local management API. Internal only; never
#                    exposed via an Ingress. Access via kubectl port-forward.
#   8001 (peer-ws) — peer handshake (/peer) and WebSocket channel (/ws). This
#                    is the only port your Ingress should forward to.
#
#   kubectl port-forward svc/porpulsion 8000:8000   # dashboard (local access)
#   kubectl port-forward svc/porpulsion 8001:8001   # peer channel (testing)

service:
  # -- Service type. ClusterIP for production; NodePort for local dev.
  type: ClusterIP

  # -- Port for the dashboard UI and local management API (internal only).
  port: 8000

  # -- NodePort for the dashboard UI. Only used when type=NodePort.
  uiNodePort: ""

  # -- Port for the peer-facing server: /peer (handshake) and /ws (WebSocket).
  #    Expose this port via your Ingress.
  peerPort: 8001

  # -- NodePort for the peer-facing server. Only used when type=NodePort.
  peerNodePort: ""

# ── Agent runtime settings ──────────────────────────────────────────────────────
# These settings are configured at runtime via the dashboard UI or the /settings
# API. They are persisted to the porpulsion-state ConfigMap and survive restarts.
# The values below are for reference only — they are NOT applied by Helm.
#
# Access control:
#   allow_inbound_remoteapps: true        # accept workloads from peers
#   require_remoteapp_approval: false     # queue for manual approval before running
#   allowed_images: ""                    # comma-sep prefixes; empty = allow all
#   blocked_images: ""                    # comma-sep prefixes; always denied
#   allowed_source_peers: ""             # comma-sep peer names; empty = all connected
#
# Tunnel control:
#   allow_inbound_tunnels: true
#   allowed_tunnel_peers: ""             # comma-sep "peer" or "peer/appid" tokens; empty = deny all
#
# Resource quotas (k8s quantity strings; "" = unlimited):
#   max_cpu_request_per_pod: ""          # e.g. "500m"
#   max_cpu_limit_per_pod: ""            # e.g. "1"
#   max_memory_request_per_pod: ""       # e.g. "256Mi"
#   max_memory_limit_per_pod: ""         # e.g. "512Mi"
#   max_replicas_per_app: 0              # 0 = unlimited
#   max_total_deployments: 0
#   max_total_pods: 0
#   max_total_cpu_requests: ""           # e.g. "8"
#   max_total_memory_requests: ""        # e.g. "32Gi"
